# 路径规划器配置（按类别组织）

visualization:
  # 同时用于栅格与路径可视化
  scale: 4
  show_grid_lines: true
  use_antialiasing: true
  image_format: "png"
  # 路径点标记（用于调试轨迹离散点；点过密会显得不丝滑）
  draw_path_points: false
  path_point_radius: 1
  max_path_point_markers: 300
  save_path_visualization: true
  # 相对路径将自动挂到 ${XLINE_WS_ROOT} 下
  output_dir: "xline_path_planner/path_visualizations"   # 栅格/路径可视化输出目录
  planned_output_dir: "xline_path_planner/planned_results"  # 规划JSON输出目录

cad_parser:
  unit_conversion_factor: 1000.0   # 毫米->米
  auto_scale_coordinates: true
  angle_unit: "DEGREES"            # 可选: DEGREES | RADIANS
  # 相对路径会挂到 ${XLINE_WS_ROOT} 下
  cad_file_dir: "xline_server/uploads/json_transformed"   # CAD文件所在目录（服务端，坐标转换后的JSON）

grid_map:
  resolution: 0.005   # 米/格
  padding: 0.1        # 地图边界填充(米)

offsets:
  left_offset: -0.25      # 左侧打印机偏移(m)
  right_offset: 0.25      # 右侧打印机偏移(m)
  center_offset: 0.0      # 中心打印机偏移(m)

path_planner:
  path_extension_start_length: 0.2 # 绘图路径起点端延长长度（米），仅影响输出轨迹/可视化，不参与共线判断
  path_extension_end_length: 0.05   # 绘图路径终点端延长长度（米），仅影响输出轨迹/可视化，不参与共线判断
  arc_extension_length: 0.4         # 圆弧起点延长弧长（米），沿圆弧路径反向延长
  arc_extension_max_angle: 90.0     # 圆弧起点延长最大角度（度），防止小半径圆弧延长过多
  transition_length_min: 0.3        # 选择下一条路径时，转场路径长度优先落在该最小值以上（米）
  transition_length_max: 1.0   # 选择下一条路径时，转场路径长度优先落在该最大值以下（米）

# 贝塞尔曲线转场路径配置
bezier_transition:
  enabled: true                     # 是否启用贝塞尔曲线转场，true→使用曲线转场，false→全部使用直线

  # 距离阈值：决定使用直线还是曲线
  min_curve_distance: 0.5           # 最小曲线转场距离（米），增大→更多转场用直线，减小→更多转场用曲线

  # 角度阈值：小角度转向时直线更高效
  min_angle_for_curve: 15.0         # 最小曲线转场角度（度），增大→更多转场用直线，减小→更多转场用曲线

  # 贝塞尔曲线参数
  control_point_ratio: 0.5          # 控制点距离比例（0.0-1.0），增大→曲线更平缓/曲率更小，减小→曲线更紧凑/曲率更大
  min_control_distance: 0.2         # 控制点最小距离（米），增大→短距离转场曲线更平缓，减小→允许更紧凑的曲线
  max_control_distance: 2.0         # 控制点最大距离（米），增大→长距离转场曲线更平缓，减小→限制曲线延展范围
  path_resolution: 0.02             # 路径离散分辨率（米），增大→路径点更稀疏/计算更快，减小→路径更精细/点更密集
  use_quintic: true                 # 五次贝塞尔曲线，true→曲率更连续/更平滑，false→三次曲线/计算更快

  # 终点切线对齐：让机器人到达终点时车头对准下一条路径
  # "align_path" - 与下一条路径方向对齐（终点曲率可能较大，但到达后可直接绘图）
  # "align_straight" - 与起终点直线方向对齐（曲率更小，但到达后需要调整朝向）
  # "blend" - 混合策略（通过blend_ratio在两者之间平衡）
  endpoint_tangent_mode: "align_path"
  blend_ratio: 0.5                  # 混合比例（仅blend模式），增大→更偏向align_path，减小→更偏向align_straight/曲率更小

  # 后退执行：当后退转向角度更小时，自动选择后退
  consider_backward: true           # 是否考虑后退执行，true→自动选择前进或后退（转向更小），false→只前进

  # 曲率控制
  min_turning_radius: 0.5           # 最小转弯半径（米），增大→直接降低最大曲率，减小→允许更急的转弯
  adaptive_control_point: true      # 自适应控制点，true→大角度转向时自动增大控制点距离，false→固定比例
  large_angle_threshold: 30.0       # 大角度转向阈值（度），降低→更早触发自适应补偿，增大→只在更大角度时补偿
  large_angle_ratio_boost: 0.5      # 大角度时控制点距离增量，增大→急转弯曲线更平滑，减小→补偿效果更弱

geometry_preprocessing:
  split_polyline: true              # 是否将 CAD 的 Polyline 拆分为多条 Line 参与规划
  preserve_polyline_info: true      # 拆分后是否保留 polyline 来源信息（parent_id/segment_index）
  merge_collinear: true             # 是否合并“共线且端点相连”的直线段为一条路径
  distance_tolerance: 0.001         # 距离容差（米），用于端点相连/点到直线距离判定（默认 1mm）
  angle_tolerance: 0.001            # 角度容差（弧度），用于方向夹角判定（越小越严格）
  min_segment_length: 0.0005        # 最小线段长度（米），短于该值的线段不参与共线合并
  circle_radius_compensation: -0.005   # 圆/圆弧半径补偿（米），仅对“路径(path)”图层生效：radius += compensation,不影响障碍/空洞图层）

# 可选：TCP服务器配置（用于非ROS客户端调用）
tcp_server:
  enabled: true                     # 是否启用 TCP 服务
  host: "192.168.0.123"             # 监听地址（0.0.0.0 表示监听所有网卡）
  port: 52088                       # 监听端口

# 可选：机器人起始位置配置
robot_start:
  enabled: true                     # 是否启用机器人起始位置
  pose_topic: "/robot_pose"         # 机器人位置话题名
  pose_timeout_sec: 5.0             # 位置超时时间（秒）
  required: false                   # 是否必须有位置才能规划（false表示没有位置时使用默认起点）
  max_initial_distance: 100.0       # 机器人到第一条路径的最大距离限制（米）
